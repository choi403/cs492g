# environment variables
f1 = c('change_1_day_change_6_month_high', 'PBR_change_6_month_low', 'PSR_ROE_high', 'PCR_change_3_month_high', 'PER_ROA_low', 'change_1_month_change_3_month_low', 'change_1_week_change_6_month_high', 'PSR_PCR_high', 'PBR_NCAV_high', 'change_1_month_ROA_low', 'change_1_month_change_6_month_high', 'change_1_month_PBR_high', 'PBR_change_3_month_high', 'change_1_day_NCAV_low', 'PSR_NCAV_low', 'PBR_GPA_high', 'change_1_day_GPA_high', 'change_1_week_ROA_high', 'PER_change_12_month_high', 'PER_PSR_low', 'PSR_ROA_low', 'change_1_day_ROA_low', 'change_1_week_NCAV_high', 'change_1_day_change_1_month_high', 'change_1_day_PER_high', 'ROE_NCAV_high', 'PSR_change_12_month_low', 'change_1_day_ROE_low', 'change_1_month_change_12_month_low', 'PER_NCAV_low', 'PCR_change_12_month_low', 'PSR_change_12_month_high', 'change_1_day_change_3_month_low', 'change_1_day_PCR_low', 'GPA_change_3_month_high', 'PCR_change_6_month_low', 'PSR_GPA_high', 'ROE_change_3_month_high', 'change_1_week_PCR_low', 'change_1_day_PSR_high', 'change_1_month_NCAV_high') 
f2 = c('PER_change_12_month_low', 'PSR_NCAV_high', 'change_1_month_change_6_month_low', 'change_1_week_ROE_low', 'PER_GPA_high', 'change_1_week_ROE_high', 'GPA_change_12_month_low', 'PER_PCR_low', 'PBR_ROA_low', 'PBR_change_3_month_low', 'GPA_change_6_month_low', 'PSR_PBR_low', 'PBR_NCAV_low', 'PCR_ROA_low', 'PBR_GPA_low', 'change_1_week_GPA_high', 'change_1_week_change_1_month_high', 'change_1_week_ROA_low', 'PCR_NCAV_low', 'PSR_PBR_high', 'change_1_week_NCAV_low', 'change_1_week_change_3_month_low', 'change_1_day_change_12_month_low', 'GPA_change_12_month_high', 'PCR_change_12_month_high', 'change_1_day_change_1_month_low', 'change_1_day_change_3_month_high', 'change_1_day_PBR_low', 'PCR_ROE_high', 'ROE_change_6_month_high', 'change_1_day_change_12_month_high', 'PCR_GPA_high', 'GPA_ROE_low', 'ROA_NCAV_low', 'change_1_week_PER_low', 'change_1_week_change_12_month_low', 'change_1_month_change_3_month_high', 'change_1_day_PBR_high', 'GPA_ROA_high', 'ROE_ROA_low', 'change_1_week_PSR_high', 'PCR_change_3_month_low', 'PCR_change_6_month_high')
f3 = c('PER_NCAV_high', 'PER_PSR_high', 'PSR_ROE_low', 'change_1_month_PSR_high', 'change_1_week_PBR_high', 'change_1_month_ROA_high', 'PSR_ROA_high', 'PER_GPA_low', 'change_1_month_PSR_low', 'PBR_ROA_high', 'change_1_week_change_1_month_low', 'change_1_month_PER_high', 'GPA_change_3_month_low', 'change_1_day_PER_low', 'PER_PBR_high', 'ROE_NCAV_low', 'change_1_month_PER_low', 'GPA_ROE_high', 'change_1_month_ROE_high', 'PBR_change_12_month_high', 'change_1_week_PBR_low', 'change_1_week_GPA_low', 'change_1_day_PSR_low', 'PCR_ROE_low', 'change_1_month_ROE_low', 'PCR_ROA_high', 'change_1_month_GPA_low', 'PER_PBR_low', 'ROE_change_3_month_low', 'change_1_day_NCAV_high', 'PCR_GPA_low', 'PSR_GPA_low', 'PSR_change_6_month_high', 'PER_change_6_month_low', 'ROE_change_6_month_low', 'ROE_ROA_high', 'PBR_ROE_low', 'PSR_change_6_month_low', 'change_1_month_PBR_low', 'GPA_change_6_month_high', 'ROA_NCAV_high', 'change_1_day_change_6_month_low', 'GPA_NCAV_low', 'PSR_change_3_month_high', 'change_1_month_NCAV_low', 'change_1_day_PCR_high', 'ROE_change_12_month_low', 'GPA_ROA_low', 'PBR_PCR_high', 'ROE_change_12_month_high', 'change_1_month_PCR_high', 'change_1_day_change_1_week_high', 'change_1_day_ROA_high', 'change_1_week_PSR_low', 'change_1_day_ROE_high', 'PSR_PCR_low', 'PBR_change_12_month_low', 'change_1_month_PCR_low', 'PBR_change_6_month_high', 'change_1_month_GPA_high', 'change_1_week_change_3_month_high', 'PBR_ROE_high', 'change_1_week_PER_high', 'change_1_week_PCR_high', 'PER_ROE_high', 'PSR_change_3_month_low', 'change_1_month_change_12_month_high', 'GPA_NCAV_high', 'change_1_day_change_1_week_low', 'PER_PCR_high', 'PER_change_3_month_high', 'PER_change_6_month_high', 'change_1_week_change_12_month_high', 'change_1_week_change_6_month_low', 'PER_ROA_high', 'PER_ROE_low', 'PER_change_3_month_low', 'PCR_NCAV_high', 'change_1_day_GPA_low', 'PBR_PCR_low')
folderpaths = c(f1, f2, f3)



# Load the package 
library("rjson")
library("corrgram")
library("scatterplot3d")
library("stringr")

# Load the data

par(mfrow=c(5, 5), mar=c(0,0,0,0))
count = 0

for(folderpath in folderpaths){
  values <- fromJSON(file = paste("./",folderpath,"/values.json", sep=""))
  factors <- fromJSON(file = paste("./",folderpath,"/factor.json", sep=""))
  second_factors <- fromJSON(file = paste("./",folderpath,"/second_factor.json", sep=""))
  
  
  # monthly growth
  monthly_growth <- c()
  monthly_factors <- c()
  monthly_second_factors <- c()
  for(i in 1:length(values)-1){
    if (F){ #folderpath == "dollar" || folderpath == "yen" || folderpath == "yuan"
      monthly_growth <- append(monthly_growth, values[i])
      monthly_factors <- append(monthly_factors, factors[i])
      monthly_second_factors <- append(monthly_second_factors, second_factors[i])
    } else {
      monthly_growth <- append(monthly_growth, ((values[i+1]/values[i])-1)*100)
      monthly_factors <- append(monthly_factors, ((factors[i+1]/factors[i]))*100)
      monthly_second_factors <- append(monthly_second_factors, ((second_factors[i+1]/second_factors[i]))*100)
    }
  }

  model = lm(monthly_factors~monthly_second_factors+monthly_growth)
  # print(summary(model))
  model_summary = summary(model)
  fstat = model_summary$fstatistic
  p_value = pf(fstat[1], fstat[2], fstat[3], lower.tail=F)
  attributes(p_value) = NULL
  
  
  if (p_value < 0.00001){
    # count = count + 1
    # print(model_summary)

    #plot(monthly_factors, monthly_growth, xlab='', ylab='', xaxt='n', yaxt='n', col="blue")
    
    scatterplot3d(monthly_factors, monthly_second_factors, monthly_growth, xlab='', ylab='', zlab='',xaxt='n', yaxt='n', zaxt='n', box=F, grid=T)
    title_text=sub("high","H",sub("low","L",str_remove(sub("week","w",sub("day","d",sub("month","m",sub("month","m",str_remove(folderpath, "_change"))))),"change_")))
    print(title_text)
    # title_text=paste(title_text, "cor:", sep="\n")
    # title_text=paste(title_text, round(test$estimate, 5), sep=" ")
    title_text=paste(title_text, "p:", sep="\n")
    title_text=paste(title_text, round(p_value, 4), sep=" ")
    title(title_text, line=-1, cex.main=1.1, col.main='red')}
  # print(count)
  
}
